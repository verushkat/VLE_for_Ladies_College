/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { Component, Input, ContentChildren, ChangeDetectionStrategy, ChangeDetectorRef, Output } from '@angular/core';
import { Subject, BehaviorSubject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { NgxFloatItemButtonComponent } from './ngx-float-item-button.component';
export class NgxFloatButtonComponent {
    /**
     * @param {?} cd
     */
    constructor(cd) {
        this.cd = cd;
        this.spaceBetweenButtons = 55;
        this.color = '#dd0031';
        this.disabled = false;
        this.events = new Subject();
        this._destroy$ = new Subject();
        this.state = new BehaviorSubject({
            display: false,
            direction: 'top',
            event: 'start',
            spaceBetweenButtons: this.spaceBetweenButtons
        });
    }
    /**
     * @return {?}
     */
    toggle() {
        if (this.disabled) {
            return this.disabled;
        }
        this.state.next(Object.assign({}, this.state.getValue(), { display: !this.state.getValue().display, event: !this.state.getValue().display ? 'open' : 'close' }));
    }
    // only top and bottom support content element
    /**
     * @return {?}
     */
    checkDirectionType() {
        if (this.buttons.toArray()) {
            /** @type {?} */
            let display = 'block';
            if (this.direction === 'right' || this.direction === 'left') {
                display = 'none';
            }
            this.buttons.toArray().forEach(element => {
                element.contentref.nativeElement.style.display = display;
            });
        }
    }
    // transition
    /**
     * @param {?} eventType
     * @return {?}
     */
    animateButtons(eventType) {
        this.buttons.toArray().forEach((btn, i) => {
            i += 1;
            /** @type {?} */
            const style = btn.elementref.nativeElement.style;
            if (eventType !== 'directionChanged' && this.state.getValue().display) {
                style['transform'] = 'scale(1)';
                style['transition-duration'] = '0s';
                if (btn.timeout) {
                    clearTimeout(btn.timeout);
                }
            }
            setTimeout(() => {
                style['transition-duration'] = this.state.getValue().display ? `${90 + 100 * i}ms` : '';
                style['transform'] = this.state.getValue().display ? this.getTranslate(i) : '';
            }, 50);
            if (eventType !== 'directionChanged' && !this.state.getValue().display) {
                btn.timeout = setTimeout(() => {
                    style['transform'] = 'scale(0)';
                }, 90 + 100 * i);
            }
        });
    }
    // get transition direction
    /**
     * @param {?} i
     * @return {?}
     */
    getTranslate(i) {
        /** @type {?} */
        let animation;
        switch (this.direction) {
            case 'right':
                animation = `translate3d(${this.state.getValue().spaceBetweenButtons * i}px,0,0)`;
                break;
            case 'bottom':
                animation = `translate3d(0,${this.state.getValue().spaceBetweenButtons * i}px,0)`;
                break;
            case 'left':
                animation = `translate3d(-${this.state.getValue().spaceBetweenButtons * i}px,0,0)`;
                break;
            default:
                animation = `translate3d(0,-${this.state.getValue().spaceBetweenButtons * i}px,0)`;
                break;
        }
        return animation;
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        if (this.direction) {
            // first time to check
            this.checkDirectionType();
        }
        this.buttons.toArray().map(v => {
            v.clicked.pipe(takeUntil(this._destroy$)).subscribe(() => {
                this.state.next(Object.assign({}, this.state.getValue(), { display: false, event: 'close' }));
            });
        });
        this.state.pipe(takeUntil(this._destroy$)).subscribe(v => {
            this.animateButtons(v.event);
            this.events.next({
                display: v.display,
                event: v.event,
                direction: v.direction
            });
        });
    }
    // if @Input values changes, we need check the direction type
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.direction && !changes.direction.firstChange) {
            this.state.next(Object.assign({}, this.state.getValue(), { event: 'directionChanged', direction: changes.direction.currentValue }));
            // if changes happens
            this.checkDirectionType();
        }
        if (changes.open && changes.open.currentValue) {
            this.open.pipe(takeUntil(this._destroy$)).subscribe(v => {
                if (v !== this.state.getValue().display) {
                    this.state.next(Object.assign({}, this.state.getValue(), { event: v ? 'open' : 'close', display: v }));
                    // make angular happy
                    this.cd.markForCheck();
                }
            });
        }
        if (changes.spaceBetweenButtons && changes.spaceBetweenButtons.currentValue) {
            this.state.next(Object.assign({}, this.state.getValue(), { event: 'spaceBetweenButtonsChanged', spaceBetweenButtons: changes.spaceBetweenButtons.currentValue }));
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this._destroy$.next();
    }
}
NgxFloatButtonComponent.decorators = [
    { type: Component, args: [{
                changeDetection: ChangeDetectionStrategy.OnPush,
                selector: 'ngx-float-button',
                template: `
    <nav class="fab-menu" [class.active]="(state | async).display">
        <a class="fab-toggle" (click)="toggle()" [style.backgroundColor]="color">
          <mat-icon> {{icon}} </mat-icon>
        </a>
        <ng-content></ng-content>
    </nav>
  `,
                styles: [`
      :host {
        position: absolute;
      }

      .fab-menu {
        box-sizing: border-box;
        font-size: 20px;
        width: 55px;
        height: 55px;
        text-align: left;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 9;
      }

      .fab-toggle {
        border-radius: 100%;
        width: 40px;
        height: 40px;
        color: white;
        text-align: center;
        line-height: 50px;
        transform: translate3d(0, 0, 0);
        transition: all ease-out 200ms;
        z-index: 2;
        transition-timing-function: cubic-bezier(0.175, 0.885, 0.32, 1.275);
        transition-duration: 400ms;
        transform: scale(1.1, 1.1) translate3d(0, 0, 0);
        cursor: pointer;
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);
      }

      .fab-menu .fab-toggle:hover {
        transform: scale(1.2, 1.2) translate3d(0, 0, 0);
      }

      .fab-menu /deep/ .item {
        opacity: 0;
      }

      .fab-menu.active /deep/ .item {
        opacity: 1;
      }

      .fab-menu.active /deep/ .content-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .fab-menu.active /deep/ .content {
        display: block;
      }

      .fab-menu.active .fab-toggle {
        transition-timing-function: linear;
        transition-duration: 200ms;
        transform: scale(0.8, 0.8) translate3d(0, 0, 0);
      }
    `]
            }] }
];
/** @nocollapse */
NgxFloatButtonComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
NgxFloatButtonComponent.propDecorators = {
    icon: [{ type: Input }],
    direction: [{ type: Input }],
    spaceBetweenButtons: [{ type: Input }],
    open: [{ type: Input }],
    color: [{ type: Input }],
    disabled: [{ type: Input }],
    events: [{ type: Output }],
    buttons: [{ type: ContentChildren, args: [NgxFloatItemButtonComponent,] }]
};
if (false) {
    /** @type {?} */
    NgxFloatButtonComponent.prototype.state;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.icon;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.direction;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.spaceBetweenButtons;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.open;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.color;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.disabled;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.events;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.buttons;
    /** @type {?} */
    NgxFloatButtonComponent.prototype._destroy$;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWZsb2F0LWJ1dHRvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtZmxvYXQtYnV0dG9uLyIsInNvdXJjZXMiOlsibGliL25neC1mbG9hdC1idXR0b24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULEtBQUssRUFDTCxlQUFlLEVBQ2YsdUJBQXVCLEVBQ3ZCLGlCQUFpQixFQUdqQixNQUFNLEVBRVAsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDaEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBK0VoRixNQUFNLE9BQU8sdUJBQXVCOzs7O0lBc0JsQyxZQUFvQixFQUFxQjtRQUFyQixPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQWR6Qyx3QkFBbUIsR0FBRyxFQUFFLENBQUM7UUFJekIsVUFBSyxHQUFHLFNBQVMsQ0FBQztRQUVsQixhQUFRLEdBQUcsS0FBSyxDQUFDO1FBRWpCLFdBQU0sR0FBaUIsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUk3QixjQUFTLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUdoQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksZUFBZSxDQUFDO1lBQy9CLE9BQU8sRUFBRSxLQUFLO1lBQ2QsU0FBUyxFQUFFLEtBQUs7WUFDaEIsS0FBSyxFQUFFLE9BQU87WUFDZCxtQkFBbUIsRUFBRSxJQUFJLENBQUMsbUJBQW1CO1NBQzlDLENBQUMsQ0FBQztJQUNMLENBQUM7Ozs7SUFFTSxNQUFNO1FBQ1gsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2pCLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztTQUN0QjtRQUNELElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxt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RUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDO2lCQUN4QjtZQUNILENBQUMsQ0FBQyxDQUFDO1NBQ0o7UUFFRCxJQUFJLE9BQU8sQ0FBQyxtQkFBbUIsSUFBSSxPQUFPLENBQUMsbUJBQW1CLENBQUMsWUFBWSxFQUFFO1lBQzNFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxtQkFDVixJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxJQUN4QixLQUFLLEVBQUUsNEJBQTRCLEVBQ25DLG1CQUFtQixFQUFFLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxZQUFZLElBQzdELENBQUM7U0FDSjtJQUNILENBQUM7Ozs7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUN4QixDQUFDOzs7WUF6UEYsU0FBUyxTQUFDO2dCQUNULGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO2dCQUMvQyxRQUFRLEVBQUUsa0JBQWtCO2dCQWtFNUIsUUFBUSxFQUFFOzs7Ozs7O0dBT1Q7eUJBdkVDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztLQThEQzthQVVKOzs7O1lBdkZDLGlCQUFpQjs7O21CQTJGaEIsS0FBSzt3QkFFTCxLQUFLO2tDQUVMLEtBQUs7bUJBRUwsS0FBSztvQkFFTCxLQUFLO3VCQUVMLEtBQUs7cUJBRUwsTUFBTTtzQkFFTixlQUFlLFNBQUMsMkJBQTJCOzs7O0lBaEI1Qyx3Q0FBbUM7O0lBRW5DLHVDQUNhOztJQUNiLDRDQUNrQjs7SUFDbEIsc0RBQ3lCOztJQUN6Qix1Q0FDdUI7O0lBQ3ZCLHdDQUNrQjs7SUFDbEIsMkNBQ2lCOztJQUNqQix5Q0FDcUM7O0lBQ3JDLDBDQUNROztJQUVSLDRDQUFrQzs7SUFFdEIscUNBQTZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBJbnB1dCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIEFmdGVyQ29udGVudEluaXQsXG4gIE9uRGVzdHJveSxcbiAgT3V0cHV0LFxuICBPbkNoYW5nZXNcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJqZWN0LCBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHsgTmd4RmxvYXRJdGVtQnV0dG9uQ29tcG9uZW50IH0gZnJvbSAnLi9uZ3gtZmxvYXQtaXRlbS1idXR0b24uY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBzZWxlY3RvcjogJ25neC1mbG9hdC1idXR0b24nLFxuICBzdHlsZXM6IFtcbiAgICBgXG4gICAgICA6aG9zdCB7XG4gICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgIH1cblxuICAgICAgLmZhYi1tZW51IHtcbiAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgICAgICAgZm9udC1zaXplOiAyMHB4O1xuICAgICAgICB3aWR0aDogNTVweDtcbiAgICAgICAgaGVpZ2h0OiA1NXB4O1xuICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0O1xuICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgICB6LWluZGV4OiA5O1xuICAgICAgfVxuXG4gICAgICAuZmFiLXRvZ2dsZSB7XG4gICAgICAgIGJvcmRlci1yYWRpdXM6IDEwMCU7XG4gICAgICAgIHdpZHRoOiA0MHB4O1xuICAgICAgICBoZWlnaHQ6IDQwcHg7XG4gICAgICAgIGNvbG9yOiB3aGl0ZTtcbiAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgICAgICBsaW5lLWhlaWdodDogNTBweDtcbiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAwLCAwKTtcbiAgICAgICAgdHJhbnNpdGlvbjogYWxsIGVhc2Utb3V0IDIwMG1zO1xuICAgICAgICB6LWluZGV4OiAyO1xuICAgICAgICB0cmFuc2l0aW9uLXRpbWluZy1mdW5jdGlvbjogY3ViaWMtYmV6aWVyKDAuMTc1LCAwLjg4NSwgMC4zMiwgMS4yNzUpO1xuICAgICAgICB0cmFuc2l0aW9uLWR1cmF0aW9uOiA0MDBtcztcbiAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEsIDEuMSkgdHJhbnNsYXRlM2QoMCwgMCwgMCk7XG4gICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgYm94LXNoYWRvdzogMCAycHggNXB4IDAgcmdiYSgwLCAwLCAwLCAwLjI2KTtcbiAgICAgIH1cblxuICAgICAgLmZhYi1tZW51IC5mYWItdG9nZ2xlOmhvdmVyIHtcbiAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjIsIDEuMikgdHJhbnNsYXRlM2QoMCwgMCwgMCk7XG4gICAgICB9XG5cbiAgICAgIC5mYWItbWVudSAvZGVlcC8gLml0ZW0ge1xuICAgICAgICBvcGFjaXR5OiAwO1xuICAgICAgfVxuXG4gICAgICAuZmFiLW1lbnUuYWN0aXZlIC9kZWVwLyAuaXRlbSB7XG4gICAgICAgIG9wYWNpdHk6IDE7XG4gICAgICB9XG5cbiAgICAgIC5mYWItbWVudS5hY3RpdmUgL2RlZXAvIC5jb250ZW50LXdyYXBwZXIge1xuICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgIH1cblxuICAgICAgLmZhYi1tZW51LmFjdGl2ZSAvZGVlcC8gLmNvbnRlbnQge1xuICAgICAgICBkaXNwbGF5OiBibG9jaztcbiAgICAgIH1cblxuICAgICAgLmZhYi1tZW51LmFjdGl2ZSAuZmFiLXRvZ2dsZSB7XG4gICAgICAgIHRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uOiBsaW5lYXI7XG4gICAgICAgIHRyYW5zaXRpb24tZHVyYXRpb246IDIwMG1zO1xuICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDAuOCwgMC44KSB0cmFuc2xhdGUzZCgwLCAwLCAwKTtcbiAgICAgIH1cbiAgICBgXG4gIF0sXG4gIHRlbXBsYXRlOiBgXG4gICAgPG5hdiBjbGFzcz1cImZhYi1tZW51XCIgW2NsYXNzLmFjdGl2ZV09XCIoc3RhdGUgfCBhc3luYykuZGlzcGxheVwiPlxuICAgICAgICA8YSBjbGFzcz1cImZhYi10b2dnbGVcIiAoY2xpY2spPVwidG9nZ2xlKClcIiBbc3R5bGUuYmFja2dyb3VuZENvbG9yXT1cImNvbG9yXCI+XG4gICAgICAgICAgPG1hdC1pY29uPiB7e2ljb259fSA8L21hdC1pY29uPlxuICAgICAgICA8L2E+XG4gICAgICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cbiAgICA8L25hdj5cbiAgYFxufSlcbmV4cG9ydCBjbGFzcyBOZ3hGbG9hdEJ1dHRvbkNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzIHtcbiAgcHVibGljIHN0YXRlOiBCZWhhdmlvclN1YmplY3Q8YW55PjtcblxuICBASW5wdXQoKVxuICBpY29uOiBzdHJpbmc7XG4gIEBJbnB1dCgpXG4gIGRpcmVjdGlvbjogc3RyaW5nO1xuICBASW5wdXQoKVxuICBzcGFjZUJldHdlZW5CdXR0b25zID0gNTU7XG4gIEBJbnB1dCgpXG4gIG9wZW46IFN1YmplY3Q8Ym9vbGVhbj47XG4gIEBJbnB1dCgpXG4gIGNvbG9yID0gJyNkZDAwMzEnO1xuICBASW5wdXQoKVxuICBkaXNhYmxlZCA9IGZhbHNlO1xuICBAT3V0cHV0KClcbiAgZXZlbnRzOiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdCgpO1xuICBAQ29udGVudENoaWxkcmVuKE5neEZsb2F0SXRlbUJ1dHRvbkNvbXBvbmVudClcbiAgYnV0dG9ucztcblxuICBwcml2YXRlIF9kZXN0cm95JCA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICB0aGlzLnN0YXRlID0gbmV3IEJlaGF2aW9yU3ViamVjdCh7XG4gICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgIGRpcmVjdGlvbjogJ3RvcCcsXG4gICAgICBldmVudDogJ3N0YXJ0JyxcbiAgICAgIHNwYWNlQmV0d2VlbkJ1dHRvbnM6IHRoaXMuc3BhY2VCZXR3ZWVuQnV0dG9uc1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHRvZ2dsZSgpIHtcbiAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xuICAgICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQ7XG4gICAgfVxuICAgIHRoaXMuc3RhdGUubmV4dCh7XG4gICAgICAuLi50aGlzLnN0YXRlLmdldFZhbHVlKCksXG4gICAgICBkaXNwbGF5OiAhdGhpcy5zdGF0ZS5nZXRWYWx1ZSgpLmRpc3BsYXksXG4gICAgICBldmVudDogIXRoaXMuc3RhdGUuZ2V0VmFsdWUoKS5kaXNwbGF5ID8gJ29wZW4nIDogJ2Nsb3NlJ1xuICAgIH0pO1xuICB9XG5cbiAgLy8gb25seSB0b3AgYW5kIGJvdHRvbSBzdXBwb3J0IGNvbnRlbnQgZWxlbWVudFxuICBwcml2YXRlIGNoZWNrRGlyZWN0aW9uVHlwZSgpIHtcbiAgICBpZiAodGhpcy5idXR0b25zLnRvQXJyYXkoKSkge1xuICAgICAgbGV0IGRpc3BsYXkgPSAnYmxvY2snO1xuXG4gICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT09ICdyaWdodCcgfHwgdGhpcy5kaXJlY3Rpb24gPT09ICdsZWZ0Jykge1xuICAgICAgICBkaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmJ1dHRvbnMudG9BcnJheSgpLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICAgIGVsZW1lbnQuY29udGVudHJlZi5uYXRpdmVFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5O1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLy8gdHJhbnNpdGlvblxuICBwcml2YXRlIGFuaW1hdGVCdXR0b25zKGV2ZW50VHlwZSkge1xuICAgIHRoaXMuYnV0dG9ucy50b0FycmF5KCkuZm9yRWFjaCgoYnRuLCBpKSA9PiB7XG4gICAgICBpICs9IDE7XG4gICAgICBjb25zdCBzdHlsZSA9IGJ0bi5lbGVtZW50cmVmLm5hdGl2ZUVsZW1lbnQuc3R5bGU7XG5cbiAgICAgIGlmIChldmVudFR5cGUgIT09ICdkaXJlY3Rpb25DaGFuZ2VkJyAmJiB0aGlzLnN0YXRlLmdldFZhbHVlKCkuZGlzcGxheSkge1xuICAgICAgICBzdHlsZVsndHJhbnNmb3JtJ10gPSAnc2NhbGUoMSknO1xuICAgICAgICBzdHlsZVsndHJhbnNpdGlvbi1kdXJhdGlvbiddID0gJzBzJztcblxuICAgICAgICBpZiAoYnRuLnRpbWVvdXQpIHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQoYnRuLnRpbWVvdXQpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBzdHlsZVsndHJhbnNpdGlvbi1kdXJhdGlvbiddID0gdGhpcy5zdGF0ZS5nZXRWYWx1ZSgpLmRpc3BsYXkgPyBgJHs5MCArIDEwMCAqIGl9bXNgIDogJyc7XG4gICAgICAgIHN0eWxlWyd0cmFuc2Zvcm0nXSA9IHRoaXMuc3RhdGUuZ2V0VmFsdWUoKS5kaXNwbGF5ID8gdGhpcy5nZXRUcmFuc2xhdGUoaSkgOiAnJztcbiAgICAgIH0sIDUwKTtcblxuICAgICAgaWYgKGV2ZW50VHlwZSAhPT0gJ2RpcmVjdGlvbkNoYW5nZWQnICYmICF0aGlzLnN0YXRlLmdldFZhbHVlKCkuZGlzcGxheSkge1xuICAgICAgICBidG4udGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHN0eWxlWyd0cmFuc2Zvcm0nXSA9ICdzY2FsZSgwKSc7XG4gICAgICAgIH0sIDkwICsgMTAwICogaSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyBnZXQgdHJhbnNpdGlvbiBkaXJlY3Rpb25cbiAgcHJpdmF0ZSBnZXRUcmFuc2xhdGUoaSkge1xuICAgIGxldCBhbmltYXRpb247XG5cbiAgICBzd2l0Y2ggKHRoaXMuZGlyZWN0aW9uKSB7XG4gICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgIGFuaW1hdGlvbiA9IGB0cmFuc2xhdGUzZCgke3RoaXMuc3RhdGUuZ2V0VmFsdWUoKS5zcGFjZUJldHdlZW5CdXR0b25zICogaX1weCwwLDApYDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdib3R0b20nOlxuICAgICAgICBhbmltYXRpb24gPSBgdHJhbnNsYXRlM2QoMCwke3RoaXMuc3RhdGUuZ2V0VmFsdWUoKS5zcGFjZUJldHdlZW5CdXR0b25zICogaX1weCwwKWA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgIGFuaW1hdGlvbiA9IGB0cmFuc2xhdGUzZCgtJHt0aGlzLnN0YXRlLmdldFZhbHVlKCkuc3BhY2VCZXR3ZWVuQnV0dG9ucyAqIGl9cHgsMCwwKWA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYW5pbWF0aW9uID0gYHRyYW5zbGF0ZTNkKDAsLSR7dGhpcy5zdGF0ZS5nZXRWYWx1ZSgpLnNwYWNlQmV0d2VlbkJ1dHRvbnMgKiBpfXB4LDApYDtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFuaW1hdGlvbjtcbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICBpZiAodGhpcy5kaXJlY3Rpb24pIHtcbiAgICAgIC8vIGZpcnN0IHRpbWUgdG8gY2hlY2tcbiAgICAgIHRoaXMuY2hlY2tEaXJlY3Rpb25UeXBlKCk7XG4gICAgfVxuXG4gICAgdGhpcy5idXR0b25zLnRvQXJyYXkoKS5tYXAodiA9PiB7XG4gICAgICB2LmNsaWNrZWQucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLnN0YXRlLm5leHQoe1xuICAgICAgICAgIC4uLnRoaXMuc3RhdGUuZ2V0VmFsdWUoKSxcbiAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICBldmVudDogJ2Nsb3NlJ1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgdGhpcy5zdGF0ZS5waXBlKHRha2VVbnRpbCh0aGlzLl9kZXN0cm95JCkpLnN1YnNjcmliZSh2ID0+IHtcbiAgICAgIHRoaXMuYW5pbWF0ZUJ1dHRvbnModi5ldmVudCk7XG5cbiAgICAgIHRoaXMuZXZlbnRzLm5leHQoe1xuICAgICAgICBkaXNwbGF5OiB2LmRpc3BsYXksXG4gICAgICAgIGV2ZW50OiB2LmV2ZW50LFxuICAgICAgICBkaXJlY3Rpb246IHYuZGlyZWN0aW9uXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIGlmIEBJbnB1dCB2YWx1ZXMgY2hhbmdlcywgd2UgbmVlZCBjaGVjayB0aGUgZGlyZWN0aW9uIHR5cGVcbiAgbmdPbkNoYW5nZXMoY2hhbmdlcykge1xuICAgIGlmIChjaGFuZ2VzLmRpcmVjdGlvbiAmJiAhY2hhbmdlcy5kaXJlY3Rpb24uZmlyc3RDaGFuZ2UpIHtcbiAgICAgIHRoaXMuc3RhdGUubmV4dCh7XG4gICAgICAgIC4uLnRoaXMuc3RhdGUuZ2V0VmFsdWUoKSxcbiAgICAgICAgZXZlbnQ6ICdkaXJlY3Rpb25DaGFuZ2VkJyxcbiAgICAgICAgZGlyZWN0aW9uOiBjaGFuZ2VzLmRpcmVjdGlvbi5jdXJyZW50VmFsdWVcbiAgICAgIH0pO1xuICAgICAgLy8gaWYgY2hhbmdlcyBoYXBwZW5zXG4gICAgICB0aGlzLmNoZWNrRGlyZWN0aW9uVHlwZSgpO1xuICAgIH1cblxuICAgIGlmIChjaGFuZ2VzLm9wZW4gJiYgY2hhbmdlcy5vcGVuLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgdGhpcy5vcGVuLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKSkuc3Vic2NyaWJlKHYgPT4ge1xuICAgICAgICBpZiAodiAhPT0gdGhpcy5zdGF0ZS5nZXRWYWx1ZSgpLmRpc3BsYXkpIHtcbiAgICAgICAgICB0aGlzLnN0YXRlLm5leHQoe1xuICAgICAgICAgICAgLi4udGhpcy5zdGF0ZS5nZXRWYWx1ZSgpLFxuICAgICAgICAgICAgZXZlbnQ6IHYgPyAnb3BlbicgOiAnY2xvc2UnLFxuICAgICAgICAgICAgZGlzcGxheTogdlxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gbWFrZSBhbmd1bGFyIGhhcHB5XG4gICAgICAgICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGNoYW5nZXMuc3BhY2VCZXR3ZWVuQnV0dG9ucyAmJiBjaGFuZ2VzLnNwYWNlQmV0d2VlbkJ1dHRvbnMuY3VycmVudFZhbHVlKSB7XG4gICAgICB0aGlzLnN0YXRlLm5leHQoe1xuICAgICAgICAuLi50aGlzLnN0YXRlLmdldFZhbHVlKCksXG4gICAgICAgIGV2ZW50OiAnc3BhY2VCZXR3ZWVuQnV0dG9uc0NoYW5nZWQnLFxuICAgICAgICBzcGFjZUJldHdlZW5CdXR0b25zOiBjaGFuZ2VzLnNwYWNlQmV0d2VlbkJ1dHRvbnMuY3VycmVudFZhbHVlXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLl9kZXN0cm95JC5uZXh0KCk7XG4gIH1cbn1cbiJdfQ==