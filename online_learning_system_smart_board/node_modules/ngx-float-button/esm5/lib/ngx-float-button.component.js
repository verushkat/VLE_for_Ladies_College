/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, ContentChildren, ChangeDetectionStrategy, ChangeDetectorRef, Output } from '@angular/core';
import { Subject, BehaviorSubject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { NgxFloatItemButtonComponent } from './ngx-float-item-button.component';
var NgxFloatButtonComponent = /** @class */ (function () {
    function NgxFloatButtonComponent(cd) {
        this.cd = cd;
        this.spaceBetweenButtons = 55;
        this.color = '#dd0031';
        this.disabled = false;
        this.events = new Subject();
        this._destroy$ = new Subject();
        this.state = new BehaviorSubject({
            display: false,
            direction: 'top',
            event: 'start',
            spaceBetweenButtons: this.spaceBetweenButtons
        });
    }
    /**
     * @return {?}
     */
    NgxFloatButtonComponent.prototype.toggle = /**
     * @return {?}
     */
    function () {
        if (this.disabled) {
            return this.disabled;
        }
        this.state.next(tslib_1.__assign({}, this.state.getValue(), { display: !this.state.getValue().display, event: !this.state.getValue().display ? 'open' : 'close' }));
    };
    // only top and bottom support content element
    // only top and bottom support content element
    /**
     * @return {?}
     */
    NgxFloatButtonComponent.prototype.checkDirectionType = 
    // only top and bottom support content element
    /**
     * @return {?}
     */
    function () {
        if (this.buttons.toArray()) {
            /** @type {?} */
            var display_1 = 'block';
            if (this.direction === 'right' || this.direction === 'left') {
                display_1 = 'none';
            }
            this.buttons.toArray().forEach(function (element) {
                element.contentref.nativeElement.style.display = display_1;
            });
        }
    };
    // transition
    // transition
    /**
     * @param {?} eventType
     * @return {?}
     */
    NgxFloatButtonComponent.prototype.animateButtons = 
    // transition
    /**
     * @param {?} eventType
     * @return {?}
     */
    function (eventType) {
        var _this = this;
        this.buttons.toArray().forEach(function (btn, i) {
            i += 1;
            /** @type {?} */
            var style = btn.elementref.nativeElement.style;
            if (eventType !== 'directionChanged' && _this.state.getValue().display) {
                style['transform'] = 'scale(1)';
                style['transition-duration'] = '0s';
                if (btn.timeout) {
                    clearTimeout(btn.timeout);
                }
            }
            setTimeout(function () {
                style['transition-duration'] = _this.state.getValue().display ? 90 + 100 * i + "ms" : '';
                style['transform'] = _this.state.getValue().display ? _this.getTranslate(i) : '';
            }, 50);
            if (eventType !== 'directionChanged' && !_this.state.getValue().display) {
                btn.timeout = setTimeout(function () {
                    style['transform'] = 'scale(0)';
                }, 90 + 100 * i);
            }
        });
    };
    // get transition direction
    // get transition direction
    /**
     * @param {?} i
     * @return {?}
     */
    NgxFloatButtonComponent.prototype.getTranslate = 
    // get transition direction
    /**
     * @param {?} i
     * @return {?}
     */
    function (i) {
        /** @type {?} */
        var animation;
        switch (this.direction) {
            case 'right':
                animation = "translate3d(" + this.state.getValue().spaceBetweenButtons * i + "px,0,0)";
                break;
            case 'bottom':
                animation = "translate3d(0," + this.state.getValue().spaceBetweenButtons * i + "px,0)";
                break;
            case 'left':
                animation = "translate3d(-" + this.state.getValue().spaceBetweenButtons * i + "px,0,0)";
                break;
            default:
                animation = "translate3d(0,-" + this.state.getValue().spaceBetweenButtons * i + "px,0)";
                break;
        }
        return animation;
    };
    /**
     * @return {?}
     */
    NgxFloatButtonComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.direction) {
            // first time to check
            this.checkDirectionType();
        }
        this.buttons.toArray().map(function (v) {
            v.clicked.pipe(takeUntil(_this._destroy$)).subscribe(function () {
                _this.state.next(tslib_1.__assign({}, _this.state.getValue(), { display: false, event: 'close' }));
            });
        });
        this.state.pipe(takeUntil(this._destroy$)).subscribe(function (v) {
            _this.animateButtons(v.event);
            _this.events.next({
                display: v.display,
                event: v.event,
                direction: v.direction
            });
        });
    };
    // if @Input values changes, we need check the direction type
    // if @Input values changes, we need check the direction type
    /**
     * @param {?} changes
     * @return {?}
     */
    NgxFloatButtonComponent.prototype.ngOnChanges = 
    // if @Input values changes, we need check the direction type
    /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        var _this = this;
        if (changes.direction && !changes.direction.firstChange) {
            this.state.next(tslib_1.__assign({}, this.state.getValue(), { event: 'directionChanged', direction: changes.direction.currentValue }));
            // if changes happens
            this.checkDirectionType();
        }
        if (changes.open && changes.open.currentValue) {
            this.open.pipe(takeUntil(this._destroy$)).subscribe(function (v) {
                if (v !== _this.state.getValue().display) {
                    _this.state.next(tslib_1.__assign({}, _this.state.getValue(), { event: v ? 'open' : 'close', display: v }));
                    // make angular happy
                    _this.cd.markForCheck();
                }
            });
        }
        if (changes.spaceBetweenButtons && changes.spaceBetweenButtons.currentValue) {
            this.state.next(tslib_1.__assign({}, this.state.getValue(), { event: 'spaceBetweenButtonsChanged', spaceBetweenButtons: changes.spaceBetweenButtons.currentValue }));
        }
    };
    /**
     * @return {?}
     */
    NgxFloatButtonComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this._destroy$.next();
    };
    NgxFloatButtonComponent.decorators = [
        { type: Component, args: [{
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    selector: 'ngx-float-button',
                    template: "\n    <nav class=\"fab-menu\" [class.active]=\"(state | async).display\">\n        <a class=\"fab-toggle\" (click)=\"toggle()\" [style.backgroundColor]=\"color\">\n          <mat-icon> {{icon}} </mat-icon>\n        </a>\n        <ng-content></ng-content>\n    </nav>\n  ",
                    styles: ["\n      :host {\n        position: absolute;\n      }\n\n      .fab-menu {\n        box-sizing: border-box;\n        font-size: 20px;\n        width: 55px;\n        height: 55px;\n        text-align: left;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        z-index: 9;\n      }\n\n      .fab-toggle {\n        border-radius: 100%;\n        width: 40px;\n        height: 40px;\n        color: white;\n        text-align: center;\n        line-height: 50px;\n        transform: translate3d(0, 0, 0);\n        transition: all ease-out 200ms;\n        z-index: 2;\n        transition-timing-function: cubic-bezier(0.175, 0.885, 0.32, 1.275);\n        transition-duration: 400ms;\n        transform: scale(1.1, 1.1) translate3d(0, 0, 0);\n        cursor: pointer;\n        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);\n      }\n\n      .fab-menu .fab-toggle:hover {\n        transform: scale(1.2, 1.2) translate3d(0, 0, 0);\n      }\n\n      .fab-menu /deep/ .item {\n        opacity: 0;\n      }\n\n      .fab-menu.active /deep/ .item {\n        opacity: 1;\n      }\n\n      .fab-menu.active /deep/ .content-wrapper {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n      }\n\n      .fab-menu.active /deep/ .content {\n        display: block;\n      }\n\n      .fab-menu.active .fab-toggle {\n        transition-timing-function: linear;\n        transition-duration: 200ms;\n        transform: scale(0.8, 0.8) translate3d(0, 0, 0);\n      }\n    "]
                }] }
    ];
    /** @nocollapse */
    NgxFloatButtonComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    NgxFloatButtonComponent.propDecorators = {
        icon: [{ type: Input }],
        direction: [{ type: Input }],
        spaceBetweenButtons: [{ type: Input }],
        open: [{ type: Input }],
        color: [{ type: Input }],
        disabled: [{ type: Input }],
        events: [{ type: Output }],
        buttons: [{ type: ContentChildren, args: [NgxFloatItemButtonComponent,] }]
    };
    return NgxFloatButtonComponent;
}());
export { NgxFloatButtonComponent };
if (false) {
    /** @type {?} */
    NgxFloatButtonComponent.prototype.state;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.icon;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.direction;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.spaceBetweenButtons;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.open;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.color;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.disabled;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.events;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.buttons;
    /** @type {?} */
    NgxFloatButtonComponent.prototype._destroy$;
    /** @type {?} */
    NgxFloatButtonComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWZsb2F0LWJ1dHRvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtZmxvYXQtYnV0dG9uLyIsInNvdXJjZXMiOlsibGliL25neC1mbG9hdC1idXR0b24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsZUFBZSxFQUNmLHVCQUF1QixFQUN2QixpQkFBaUIsRUFHakIsTUFBTSxFQUVQLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2hELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUzQyxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUVoRjtJQW1HRSxpQ0FBb0IsRUFBcUI7UUFBckIsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFkekMsd0JBQW1CLEdBQUcsRUFBRSxDQUFDO1FBSXpCLFVBQUssR0FBRyxTQUFTLENBQUM7UUFFbEIsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUVqQixXQUFNLEdBQWlCLElBQUksT0FBTyxFQUFFLENBQUM7UUFJN0IsY0FBUyxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7UUFHaEMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLGVBQWUsQ0FBQztZQUMvQixPQUFPLEVBQUUsS0FBSztZQUNkLFNBQVMsRUFBRSxLQUFLO1lBQ2hCLEtBQUssRUFBRSxPQUFPO1lBQ2QsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLG1CQUFtQjtTQUM5QyxDQUFDLENBQUM7SUFDTCxDQUFDOzs7O0lBRU0sd0NBQU07OztJQUFiO1FBQ0UsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2pCLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztTQUN0QjtRQUNELElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxzQkFDVixJQUFJLENB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IElucHV0LFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgT25EZXN0cm95LFxuICBPdXRwdXQsXG4gIE9uQ2hhbmdlc1xufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YmplY3QsIEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBOZ3hGbG9hdEl0ZW1CdXR0b25Db21wb25lbnQgfSBmcm9tICcuL25neC1mbG9hdC1pdGVtLWJ1dHRvbi5jb21wb25lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHNlbGVjdG9yOiAnbmd4LWZsb2F0LWJ1dHRvbicsXG4gIHN0eWxlczogW1xuICAgIGBcbiAgICAgIDpob3N0IHtcbiAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgfVxuXG4gICAgICAuZmFiLW1lbnUge1xuICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAgICAgICBmb250LXNpemU6IDIwcHg7XG4gICAgICAgIHdpZHRoOiA1NXB4O1xuICAgICAgICBoZWlnaHQ6IDU1cHg7XG4gICAgICAgIHRleHQtYWxpZ246IGxlZnQ7XG4gICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgICAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgICAgIHotaW5kZXg6IDk7XG4gICAgICB9XG5cbiAgICAgIC5mYWItdG9nZ2xlIHtcbiAgICAgICAgYm9yZGVyLXJhZGl1czogMTAwJTtcbiAgICAgICAgd2lkdGg6IDQwcHg7XG4gICAgICAgIGhlaWdodDogNDBweDtcbiAgICAgICAgY29sb3I6IHdoaXRlO1xuICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICAgIGxpbmUtaGVpZ2h0OiA1MHB4O1xuICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIDAsIDApO1xuICAgICAgICB0cmFuc2l0aW9uOiBhbGwgZWFzZS1vdXQgMjAwbXM7XG4gICAgICAgIHotaW5kZXg6IDI7XG4gICAgICAgIHRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoMC4xNzUsIDAuODg1LCAwLjMyLCAxLjI3NSk7XG4gICAgICAgIHRyYW5zaXRpb24tZHVyYXRpb246IDQwMG1zO1xuICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMSwgMS4xKSB0cmFuc2xhdGUzZCgwLCAwLCAwKTtcbiAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgICBib3gtc2hhZG93OiAwIDJweCA1cHggMCByZ2JhKDAsIDAsIDAsIDAuMjYpO1xuICAgICAgfVxuXG4gICAgICAuZmFiLW1lbnUgLmZhYi10b2dnbGU6aG92ZXIge1xuICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMiwgMS4yKSB0cmFuc2xhdGUzZCgwLCAwLCAwKTtcbiAgICAgIH1cblxuICAgICAgLmZhYi1tZW51IC9kZWVwLyAuaXRlbSB7XG4gICAgICAgIG9wYWNpdHk6IDA7XG4gICAgICB9XG5cbiAgICAgIC5mYWItbWVudS5hY3RpdmUgL2RlZXAvIC5pdGVtIHtcbiAgICAgICAgb3BhY2l0eTogMTtcbiAgICAgIH1cblxuICAgICAgLmZhYi1tZW51LmFjdGl2ZSAvZGVlcC8gLmNvbnRlbnQtd3JhcHBlciB7XG4gICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgfVxuXG4gICAgICAuZmFiLW1lbnUuYWN0aXZlIC9kZWVwLyAuY29udGVudCB7XG4gICAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgICAgfVxuXG4gICAgICAuZmFiLW1lbnUuYWN0aXZlIC5mYWItdG9nZ2xlIHtcbiAgICAgICAgdHJhbnNpdGlvbi10aW1pbmctZnVuY3Rpb246IGxpbmVhcjtcbiAgICAgICAgdHJhbnNpdGlvbi1kdXJhdGlvbjogMjAwbXM7XG4gICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMC44LCAwLjgpIHRyYW5zbGF0ZTNkKDAsIDAsIDApO1xuICAgICAgfVxuICAgIGBcbiAgXSxcbiAgdGVtcGxhdGU6IGBcbiAgICA8bmF2IGNsYXNzPVwiZmFiLW1lbnVcIiBbY2xhc3MuYWN0aXZlXT1cIihzdGF0ZSB8IGFzeW5jKS5kaXNwbGF5XCI+XG4gICAgICAgIDxhIGNsYXNzPVwiZmFiLXRvZ2dsZVwiIChjbGljayk9XCJ0b2dnbGUoKVwiIFtzdHlsZS5iYWNrZ3JvdW5kQ29sb3JdPVwiY29sb3JcIj5cbiAgICAgICAgICA8bWF0LWljb24+IHt7aWNvbn19IDwvbWF0LWljb24+XG4gICAgICAgIDwvYT5cbiAgICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgIDwvbmF2PlxuICBgXG59KVxuZXhwb3J0IGNsYXNzIE5neEZsb2F0QnV0dG9uQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJDb250ZW50SW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMge1xuICBwdWJsaWMgc3RhdGU6IEJlaGF2aW9yU3ViamVjdDxhbnk+O1xuXG4gIEBJbnB1dCgpXG4gIGljb246IHN0cmluZztcbiAgQElucHV0KClcbiAgZGlyZWN0aW9uOiBzdHJpbmc7XG4gIEBJbnB1dCgpXG4gIHNwYWNlQmV0d2VlbkJ1dHRvbnMgPSA1NTtcbiAgQElucHV0KClcbiAgb3BlbjogU3ViamVjdDxib29sZWFuPjtcbiAgQElucHV0KClcbiAgY29sb3IgPSAnI2RkMDAzMSc7XG4gIEBJbnB1dCgpXG4gIGRpc2FibGVkID0gZmFsc2U7XG4gIEBPdXRwdXQoKVxuICBldmVudHM6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0KCk7XG4gIEBDb250ZW50Q2hpbGRyZW4oTmd4RmxvYXRJdGVtQnV0dG9uQ29tcG9uZW50KVxuICBidXR0b25zO1xuXG4gIHByaXZhdGUgX2Rlc3Ryb3kkID0gbmV3IFN1YmplY3QoKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICAgIHRoaXMuc3RhdGUgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KHtcbiAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgZGlyZWN0aW9uOiAndG9wJyxcbiAgICAgIGV2ZW50OiAnc3RhcnQnLFxuICAgICAgc3BhY2VCZXR3ZWVuQnV0dG9uczogdGhpcy5zcGFjZUJldHdlZW5CdXR0b25zXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgdG9nZ2xlKCkge1xuICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XG4gICAgICByZXR1cm4gdGhpcy5kaXNhYmxlZDtcbiAgICB9XG4gICAgdGhpcy5zdGF0ZS5uZXh0KHtcbiAgICAgIC4uLnRoaXMuc3RhdGUuZ2V0VmFsdWUoKSxcbiAgICAgIGRpc3BsYXk6ICF0aGlzLnN0YXRlLmdldFZhbHVlKCkuZGlzcGxheSxcbiAgICAgIGV2ZW50OiAhdGhpcy5zdGF0ZS5nZXRWYWx1ZSgpLmRpc3BsYXkgPyAnb3BlbicgOiAnY2xvc2UnXG4gICAgfSk7XG4gIH1cblxuICAvLyBvbmx5IHRvcCBhbmQgYm90dG9tIHN1cHBvcnQgY29udGVudCBlbGVtZW50XG4gIHByaXZhdGUgY2hlY2tEaXJlY3Rpb25UeXBlKCkge1xuICAgIGlmICh0aGlzLmJ1dHRvbnMudG9BcnJheSgpKSB7XG4gICAgICBsZXQgZGlzcGxheSA9ICdibG9jayc7XG5cbiAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PT0gJ3JpZ2h0JyB8fCB0aGlzLmRpcmVjdGlvbiA9PT0gJ2xlZnQnKSB7XG4gICAgICAgIGRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuYnV0dG9ucy50b0FycmF5KCkuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgICAgZWxlbWVudC5jb250ZW50cmVmLm5hdGl2ZUVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvLyB0cmFuc2l0aW9uXG4gIHByaXZhdGUgYW5pbWF0ZUJ1dHRvbnMoZXZlbnRUeXBlKSB7XG4gICAgdGhpcy5idXR0b25zLnRvQXJyYXkoKS5mb3JFYWNoKChidG4sIGkpID0+IHtcbiAgICAgIGkgKz0gMTtcbiAgICAgIGNvbnN0IHN0eWxlID0gYnRuLmVsZW1lbnRyZWYubmF0aXZlRWxlbWVudC5zdHlsZTtcblxuICAgICAgaWYgKGV2ZW50VHlwZSAhPT0gJ2RpcmVjdGlvbkNoYW5nZWQnICYmIHRoaXMuc3RhdGUuZ2V0VmFsdWUoKS5kaXNwbGF5KSB7XG4gICAgICAgIHN0eWxlWyd0cmFuc2Zvcm0nXSA9ICdzY2FsZSgxKSc7XG4gICAgICAgIHN0eWxlWyd0cmFuc2l0aW9uLWR1cmF0aW9uJ10gPSAnMHMnO1xuXG4gICAgICAgIGlmIChidG4udGltZW91dCkge1xuICAgICAgICAgIGNsZWFyVGltZW91dChidG4udGltZW91dCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHN0eWxlWyd0cmFuc2l0aW9uLWR1cmF0aW9uJ10gPSB0aGlzLnN0YXRlLmdldFZhbHVlKCkuZGlzcGxheSA/IGAkezkwICsgMTAwICogaX1tc2AgOiAnJztcbiAgICAgICAgc3R5bGVbJ3RyYW5zZm9ybSddID0gdGhpcy5zdGF0ZS5nZXRWYWx1ZSgpLmRpc3BsYXkgPyB0aGlzLmdldFRyYW5zbGF0ZShpKSA6ICcnO1xuICAgICAgfSwgNTApO1xuXG4gICAgICBpZiAoZXZlbnRUeXBlICE9PSAnZGlyZWN0aW9uQ2hhbmdlZCcgJiYgIXRoaXMuc3RhdGUuZ2V0VmFsdWUoKS5kaXNwbGF5KSB7XG4gICAgICAgIGJ0bi50aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgc3R5bGVbJ3RyYW5zZm9ybSddID0gJ3NjYWxlKDApJztcbiAgICAgICAgfSwgOTAgKyAxMDAgKiBpKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIGdldCB0cmFuc2l0aW9uIGRpcmVjdGlvblxuICBwcml2YXRlIGdldFRyYW5zbGF0ZShpKSB7XG4gICAgbGV0IGFuaW1hdGlvbjtcblxuICAgIHN3aXRjaCAodGhpcy5kaXJlY3Rpb24pIHtcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgYW5pbWF0aW9uID0gYHRyYW5zbGF0ZTNkKCR7dGhpcy5zdGF0ZS5nZXRWYWx1ZSgpLnNwYWNlQmV0d2VlbkJ1dHRvbnMgKiBpfXB4LDAsMClgO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2JvdHRvbSc6XG4gICAgICAgIGFuaW1hdGlvbiA9IGB0cmFuc2xhdGUzZCgwLCR7dGhpcy5zdGF0ZS5nZXRWYWx1ZSgpLnNwYWNlQmV0d2VlbkJ1dHRvbnMgKiBpfXB4LDApYDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdsZWZ0JzpcbiAgICAgICAgYW5pbWF0aW9uID0gYHRyYW5zbGF0ZTNkKC0ke3RoaXMuc3RhdGUuZ2V0VmFsdWUoKS5zcGFjZUJldHdlZW5CdXR0b25zICogaX1weCwwLDApYDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBhbmltYXRpb24gPSBgdHJhbnNsYXRlM2QoMCwtJHt0aGlzLnN0YXRlLmdldFZhbHVlKCkuc3BhY2VCZXR3ZWVuQnV0dG9ucyAqIGl9cHgsMClgO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gYW5pbWF0aW9uO1xuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgIGlmICh0aGlzLmRpcmVjdGlvbikge1xuICAgICAgLy8gZmlyc3QgdGltZSB0byBjaGVja1xuICAgICAgdGhpcy5jaGVja0RpcmVjdGlvblR5cGUoKTtcbiAgICB9XG5cbiAgICB0aGlzLmJ1dHRvbnMudG9BcnJheSgpLm1hcCh2ID0+IHtcbiAgICAgIHYuY2xpY2tlZC5waXBlKHRha2VVbnRpbCh0aGlzLl9kZXN0cm95JCkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIHRoaXMuc3RhdGUubmV4dCh7XG4gICAgICAgICAgLi4udGhpcy5zdGF0ZS5nZXRWYWx1ZSgpLFxuICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgICAgIGV2ZW50OiAnY2xvc2UnXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLnN0YXRlLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKSkuc3Vic2NyaWJlKHYgPT4ge1xuICAgICAgdGhpcy5hbmltYXRlQnV0dG9ucyh2LmV2ZW50KTtcblxuICAgICAgdGhpcy5ldmVudHMubmV4dCh7XG4gICAgICAgIGRpc3BsYXk6IHYuZGlzcGxheSxcbiAgICAgICAgZXZlbnQ6IHYuZXZlbnQsXG4gICAgICAgIGRpcmVjdGlvbjogdi5kaXJlY3Rpb25cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gaWYgQElucHV0IHZhbHVlcyBjaGFuZ2VzLCB3ZSBuZWVkIGNoZWNrIHRoZSBkaXJlY3Rpb24gdHlwZVxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzKSB7XG4gICAgaWYgKGNoYW5nZXMuZGlyZWN0aW9uICYmICFjaGFuZ2VzLmRpcmVjdGlvbi5maXJzdENoYW5nZSkge1xuICAgICAgdGhpcy5zdGF0ZS5uZXh0KHtcbiAgICAgICAgLi4udGhpcy5zdGF0ZS5nZXRWYWx1ZSgpLFxuICAgICAgICBldmVudDogJ2RpcmVjdGlvbkNoYW5nZWQnLFxuICAgICAgICBkaXJlY3Rpb246IGNoYW5nZXMuZGlyZWN0aW9uLmN1cnJlbnRWYWx1ZVxuICAgICAgfSk7XG4gICAgICAvLyBpZiBjaGFuZ2VzIGhhcHBlbnNcbiAgICAgIHRoaXMuY2hlY2tEaXJlY3Rpb25UeXBlKCk7XG4gICAgfVxuXG4gICAgaWYgKGNoYW5nZXMub3BlbiAmJiBjaGFuZ2VzLm9wZW4uY3VycmVudFZhbHVlKSB7XG4gICAgICB0aGlzLm9wZW4ucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpKS5zdWJzY3JpYmUodiA9PiB7XG4gICAgICAgIGlmICh2ICE9PSB0aGlzLnN0YXRlLmdldFZhbHVlKCkuZGlzcGxheSkge1xuICAgICAgICAgIHRoaXMuc3RhdGUubmV4dCh7XG4gICAgICAgICAgICAuLi50aGlzLnN0YXRlLmdldFZhbHVlKCksXG4gICAgICAgICAgICBldmVudDogdiA/ICdvcGVuJyA6ICdjbG9zZScsXG4gICAgICAgICAgICBkaXNwbGF5OiB2XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyBtYWtlIGFuZ3VsYXIgaGFwcHlcbiAgICAgICAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoY2hhbmdlcy5zcGFjZUJldHdlZW5CdXR0b25zICYmIGNoYW5nZXMuc3BhY2VCZXR3ZWVuQnV0dG9ucy5jdXJyZW50VmFsdWUpIHtcbiAgICAgIHRoaXMuc3RhdGUubmV4dCh7XG4gICAgICAgIC4uLnRoaXMuc3RhdGUuZ2V0VmFsdWUoKSxcbiAgICAgICAgZXZlbnQ6ICdzcGFjZUJldHdlZW5CdXR0b25zQ2hhbmdlZCcsXG4gICAgICAgIHNwYWNlQmV0d2VlbkJ1dHRvbnM6IGNoYW5nZXMuc3BhY2VCZXR3ZWVuQnV0dG9ucy5jdXJyZW50VmFsdWVcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuX2Rlc3Ryb3kkLm5leHQoKTtcbiAgfVxufVxuIl19